{% extends "base.html" %}
{% block title %}Order #{{ order.id }}{% endblock %}

{% block content %}
<div class="glass-container">
    <a href="{{ url_for('dashboard.customer_dashboard') }}" class="btn"
        style="background-color: #777; margin-bottom: 20px;">&larr; Back to Dashboard</a>

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Order #{{ order.id }}</h2>
        <span class="badge badge-success" style="font-size: 1rem;">{{ order.status }}</span>
    </div>
    <p><strong>Date:</strong> {{ order.order_date.strftime('%Y-%m-%d %H:%M') }}</p>
    <p><strong>Expected Delivery:</strong> <span style="color: var(--success-color);">{{
            expected_delivery.strftime('%Y-%m-%d') }}</span></p>

    <h3>Items in this Order</h3>
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.order_items %}
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="{{ item.product.image_url }}" alt="{{ item.product.name }}"
                            style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                        <a href="{{ url_for('shop.product_details', product_id=item.product.id) }}"
                            style="font-weight: bold; color: var(--primary-color);">{{ item.product.name }}</a>
                    </div>
                </td>
                <td>${{ item.price_at_purchase }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ "%.2f"|format(item.price_at_purchase * item.quantity) }}</td>
                <td>
                    <a href="{{ url_for('shop.product_details', product_id=item.product.id) }}" class="btn"
                        style="padding: 5px 10px; font-size: 0.8em; background-color: #555;">View Product</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" style="text-align: right; font-weight: bold;">Order Total:</td>
                <td style="font-weight: bold; font-size: 1.2em;">${{ "%.2f"|format(order.total_amount) }}</td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    {% if order.status == 'delivered' %}
    <div style="margin-top: 2rem; background: rgba(255,255,255,0.5); padding: 1.5rem; border-radius: 8px;">
        <h3>Need to return an item?</h3>
        <p>If you are not satisfied with your purchase, you can request a return.</p>
        <a href="{{ url_for('dashboard.request_return', order_id=order.id) }}" class="btn btn-warning">Request
            Return</a>
    </div>
    {% endif %}
</div>
{% endblock %}